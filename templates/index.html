<!DOCTYPE html>
<html lang="ko">

<style>
body {padding: 16px; font-family: sans-serif; font-size: 14px; color: #444}
table {padding: 16px; font-family: sans-serif; font-size: 14px; color: #444}
input {font-size: 14px; padding: 8px 12px; outline: none; border: 1px solid #ddd}
input:focus {box-shadow: 0 1px 2px rgba(0,0,0,.15)}
p {padding: 12px}
textarea {padding: 10px}
button {background: #28d; padding: 9px 14px; margin-left: 8px; border: none; outline: none;
        color: #fff; font-size: 14px; border-radius: 4px; cursor: pointer;}
button:hover {box-shadow: 0 1px 2px rgba(0,0,0,.15); opacity: 0.9;}
button:active {background: #29f;}
button[disabled] {opacity: 0.4; cursor: default}
</style>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <style type="text/css">
        .TableHeaderStyle{background-color:#4172c7;color:white;text-align:center}
        .TableOddRowStyle{background-color:#d2d9ee;color:black;text-align:center}
        .TableEvenRowStyle{background-color:#eaedf6;color:black;text-align:center}
        .RowLableStyle{text-align:left}
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"> </script>
    <title> Flagship AI Project: 감정표현 음성합성 데모 </title>
</head>

<body>
    <h1>
        Flagship AI Project: 감정표현 음성합성 데모
    </h1>

    version 0.1<br>
    KAIST, KI4AI, Sejik Park (sejik6307@gmail.com)

    <p>
        <span style="font-weight:bold;"> Note: 크롬에서 실행 부탁드립니다. 다른 브라우저와 호환이 안 될 수 있습니다. </span>
    </p>

    <p>
        Flagship AI Project 감정표현 음성합성 데모 페이지입니다.<br>
        SSML을 활용하여 음성을 합성할 수 있도록 하였습니다.<br>
        감정 7종류 (행복, 슬픔, 화남, 무서움, 역겨움, 놀람, 중립), 화자 2명(남, 여)에 대해 음성합성을 할 수 있습니다.<br>
        그 외 4차년도에는 더 많은 화자에 대해 음성합성이 가능합니다. (name="숫자")<br>
        
        SSML 작성을 돕기 위해 한국어 normalization이 포함된 text to ssml translation을 함께 사용할 수 있습니다.<br>
        <br>

        <form>
            <input class="content1" id="content1" type="content1" size="150" value="안녕하세요, 감정을 담아 말하는 음성합성기입니다.">
            <br><br>

            <button id="button1" name="translation">
                Translation
            </button>

            <br><br>

            <textarea class="content" id="content" name="content" cols="150" rows="10" >
<speak><lexicon dict="국립국어원 표준국어대사전.csv" xml:id="국립국어원 표준국어대사전"/>
    <lookup ref="국립국어원 표준국어대사전">
        <p>
            <s>
               <voice name="6">
               <emotion class="Neutral">안녕하세요, </emotion>
               </voice>
            </s>
            <s>
               <voice name="6">
               <emotion class="Sad">요즘 코로나 때문에 걱정이 많으실거에요. </emotion>
               </voice>
            </s>
            <s>
               <voice name="6">
               <emotion class="Fear">저도 걱정이 이만저만 아니랍니다. </emotion>
               </voice>
            </s>
            <s>
               <voice name="6">
               <emotion class="Angry">요즘 밖에 잘 나가지도 못해서 너무 답답해요.</emotion>
               </voice>
            </s>
            <s>
               <voice name="6">
               <emotion class="Happy">곧 좋은 일이 올 거라고 믿어요. </emotion>
               </voice>
            </s>
        </p>
    </lookup>
</speak>
            </textarea>
            <br>
            <button id="button" name="synthesize">
                Speak
            </button>
        </form>
        <p id="message"></p>
        <audio id="audio1" controls hidden></audio>
    </p>

    <h2>Flagship AI Project: 감정표현 음성합성 데모 예시</h2>
        <h3>음성합성기 구조 개선을 통한 음질 개선</h3>
            <div class="colorscripter-code" style="color:#010101;font-family:sans-serif !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:sans-serif !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div><div style="line-height:130%">17</div><div style="line-height:130%">18</div><div style="line-height:130%">19</div><div style="line-height:130%">20</div><div style="line-height:130%">21</div><div style="line-height:130%">22</div><div style="line-height:130%">23</div><div style="line-height:130%">24</div><div style="line-height:130%">25</div><div style="line-height:130%">26</div><div style="line-height:130%">27</div><div style="line-height:130%">28</div><div style="line-height:130%">29</div><div style="line-height:130%">30</div><div style="line-height:130%">31</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:sans-serif !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#010101">&lt;</span><span style="color:#ff3399">speak</span><span style="color:#010101">&gt;</span><span style="color:#010101">&lt;</span><span style="color:#ff3399">lexicon</span>&nbsp;<span style="color:#0099cc">dict</span>=<span style="color:#52be14">"국립국어원&nbsp;표준국어대사전.csv"</span><span style="color:#0099cc"></span>&nbsp;<span style="color:#0099cc">xml:id</span>=<span style="color:#52be14">"국립국어원&nbsp;표준국어대사전"</span><span style="color:#0099cc">/</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">lookup</span>&nbsp;<span style="color:#0099cc">ref</span>=<span style="color:#52be14">"국립국어원&nbsp;표준국어대사전"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">p</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">voice</span>&nbsp;<span style="color:#0099cc">name</span>=<span style="color:#52be14">"6"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">emotion</span>&nbsp;<span style="color:#0099cc">class</span>=<span style="color:#52be14">"Neutral"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span>안녕하세요,&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">emotion</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">voice</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">voice</span>&nbsp;<span style="color:#0099cc">name</span>=<span style="color:#52be14">"6"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">emotion</span>&nbsp;<span style="color:#0099cc">class</span>=<span style="color:#52be14">"Sad"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span>요즘&nbsp;코로나&nbsp;때문에&nbsp;걱정이&nbsp;많으실거에요.&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">emotion</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">voice</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">voice</span>&nbsp;<span style="color:#0099cc">name</span>=<span style="color:#52be14">"6"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">emotion</span>&nbsp;<span style="color:#0099cc">class</span>=<span style="color:#52be14">"Fear"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span>저도&nbsp;걱정이&nbsp;이만저만&nbsp;아니랍니다.&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">emotion</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">voice</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">voice</span>&nbsp;<span style="color:#0099cc">name</span>=<span style="color:#52be14">"6"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">emotion</span>&nbsp;<span style="color:#0099cc">class</span>=<span style="color:#52be14">"Angry"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span>요즘&nbsp;밖에&nbsp;잘&nbsp;나가지도&nbsp;못해서&nbsp;너무&nbsp;답답해요.<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">emotion</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">voice</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">voice</span>&nbsp;<span style="color:#0099cc">name</span>=<span style="color:#52be14">"6"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#ff3399">emotion</span>&nbsp;<span style="color:#0099cc">class</span>=<span style="color:#52be14">"Happy"</span><span style="color:#0099cc"></span><span style="color:#010101">&gt;</span>곧&nbsp;좋은&nbsp;일이&nbsp;올&nbsp;거라고&nbsp;믿어요.&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">emotion</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">voice</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">s</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">p</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">lookup</span><span style="color:#010101">&gt;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#010101">&lt;</span><span style="color:#010101">/</span><span style="color:#ff3399">speak</span><span style="color:#010101">&gt;</span></div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#e5e5e5text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>
    <br>
        
        <audio controls preload="none">
            <source src="https://drive.google.com/uc?export=download&id=116iP70nB1TJAx5v_-cZHIISyRLLIK_Ii" type="audio/mp3">
        </audio>
    
    <script>
        function q(selector) {return document.querySelector(selector)}
        q('#content').focus()
        q('#button1').addEventListener('click', function(e) {
            text = q('#content1').value
            if (text) {
                translation(text)
            }
            e.preventDefault()
                return false
        })
        function translation(text) {
            fetch('/translation', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(text),
            }).then(function(res) {
                if (!res.ok) throw Error(response.statusText)
                    return res.json()
            }).then(function(json) {
                q('#content').value = json
            })
        }
        q('#button').addEventListener('click', function(e) {
            text = q('#content').value
            if (text) {
                q('#message').textContent = 'Synthesizing...'
                q('#button').disabled = true
                q('#audio1').hidden = true
                synthesize1(text)
            }
            e.preventDefault()
                return false
        })
        function synthesize1(text) {
            fetch('/synthesize', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(text.replace("<speak>","<speak version=\"4차년도\">")),
            }).then(function(res) {
                if (!res.ok) throw Error(response.statusText)
                    return res.json()
            }).then(function(json) {
                q('#message').textContent = json
                q('#button').disabled = false
                
                fetch('/play_audio?text=' + '1', {cache: 'no-cache'})
                .then(function(res) {
                    if (!res.ok) throw Error(response.statusText)
                        return res.blob()
                }).then(function(blob) {
                    q('#audio1').src = URL.createObjectURL(blob)
                    q('#audio1').hidden = false
               }).catch(function(err) {
                    q('#message').textContent = 'Error: ' + err.message
                    q('#button').disabled = false
               })
    
               
    
            }).catch(function(err) {
                q('#message').textContent = 'Error: ' + err.message
                q('#button').disabled = false
            })
        }
    </script>

</body>
</html>